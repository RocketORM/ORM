
{% block comments -%}
-- ------------------------------------------------------------------------
-- This file is generated by Rocket ORM
-- Do not edit this file, please edit the related schema configuration file
--
-- "{{ schema.database }}" database ({% block driver 'MySQL' %}), with {{ schema.tables|length }} table{{ 1 < schema.tables|length ? 's' : '' }}
-- ------------------------------------------------------------------------
{%- endblock comments %}
{{ "\n" }}
{% block header -%}
SET FOREIGN_KEY_CHECKS = 0;
{{ "\n" }}
{%- endblock header %}
{% for table in schema.tables -%}
    {% block create_table -%}
        CREATE TABLE IF NOT EXISTS `{{ table.name }}` (
    {%- endblock create_table %}

        {%- block columns -%}
            {%- for column in table.columns -%}
                {% include [
                    '@' ~ driver ~ '/Column/' ~ column.typeAsString ~ '.sql.twig', 'Column/' ~ column.typeAsString ~ '.sql.twig',
                    '@' ~ driver ~ '/Column/column.sql.twig', 'Column/column.sql.twig'
                ] %}
                {{- loop.last ? '' : ',' }}
            {%- endfor %}
        {%- endblock columns %}

        {%- block primary_keys %}
            {%- set primaryKeys = table.primaryKeys %}
            {%- if 0 < primaryKeys|length -%}
                ,{{ "\n\n    " -}}
                PRIMARY KEY (
                {%- for primaryKey in primaryKeys -%}
                    `{{ primaryKey.name }}`
                    {{- loop.last ? '' : ', ' }}
                {%- endfor -%}
                )
            {%- endif %}
        {%- endblock primary_keys %}

        {%- block foreign_keys %}
            {%- if table.hasForeignKey -%}
                ,{{ "\n    " -}}
                {% for relations in table.foreignKeys -%}
                    FOREIGN KEY (
                    {%- for relation in relations -%}
                        `{{ relation.local }}`
                        {{- loop.last ? '' : ', ' }}
                    {%- endfor -%}
                    ) REFERENCES `{{ relations[0].relatedTable.schema.database }}`.`{{ relations[0].relatedTable.name }}` (`{{ relations[0].foreign }}`) ON UPDATE {{ relations[0].onUpdate }} ON DELETE {{ relations[0].onDelete }}
                    {{- loop.last ? '' : ",\n    " }}
                {%- endfor %}
            {%- endif %}
        {%- endblock foreign_keys %}

) {% block engine %}ENGINE=`{{ table.type }}`{% endblock engine %};
{{ "\n" }}
{%- endfor %}
{%- block footer -%}
    SET FOREIGN_KEY_CHECKS = 1;
{%- endblock footer %}